{"version":3,"file":"delayed_stream.js","sources":["../../../../node_modules/delayed-stream/lib/delayed_stream.js"],"sourcesContent":["var Stream = require('stream').Stream;\nvar util = require('util');\n\nmodule.exports = DelayedStream;\nfunction DelayedStream() {\n  this.source = null;\n  this.dataSize = 0;\n  this.maxDataSize = 1024 * 1024;\n  this.pauseStream = true;\n\n  this._maxDataSizeExceeded = false;\n  this._released = false;\n  this._bufferedEvents = [];\n}\nutil.inherits(DelayedStream, Stream);\n\nDelayedStream.create = function(source, options) {\n  var delayedStream = new this();\n\n  options = options || {};\n  for (var option in options) {\n    delayedStream[option] = options[option];\n  }\n\n  delayedStream.source = source;\n\n  var realEmit = source.emit;\n  source.emit = function() {\n    delayedStream._handleEmit(arguments);\n    return realEmit.apply(source, arguments);\n  };\n\n  source.on('error', function() {});\n  if (delayedStream.pauseStream) {\n    source.pause();\n  }\n\n  return delayedStream;\n};\n\nObject.defineProperty(DelayedStream.prototype, 'readable', {\n  configurable: true,\n  enumerable: true,\n  get: function() {\n    return this.source.readable;\n  }\n});\n\nDelayedStream.prototype.setEncoding = function() {\n  return this.source.setEncoding.apply(this.source, arguments);\n};\n\nDelayedStream.prototype.resume = function() {\n  if (!this._released) {\n    this.release();\n  }\n\n  this.source.resume();\n};\n\nDelayedStream.prototype.pause = function() {\n  this.source.pause();\n};\n\nDelayedStream.prototype.release = function() {\n  this._released = true;\n\n  this._bufferedEvents.forEach(function(args) {\n    this.emit.apply(this, args);\n  }.bind(this));\n  this._bufferedEvents = [];\n};\n\nDelayedStream.prototype.pipe = function() {\n  var r = Stream.prototype.pipe.apply(this, arguments);\n  this.resume();\n  return r;\n};\n\nDelayedStream.prototype._handleEmit = function(args) {\n  if (this._released) {\n    this.emit.apply(this, args);\n    return;\n  }\n\n  if (args[0] === 'data') {\n    this.dataSize += args[1].length;\n    this._checkIfMaxDataSizeExceeded();\n  }\n\n  this._bufferedEvents.push(args);\n};\n\nDelayedStream.prototype._checkIfMaxDataSizeExceeded = function() {\n  if (this._maxDataSizeExceeded) {\n    return;\n  }\n\n  if (this.dataSize <= this.maxDataSize) {\n    return;\n  }\n\n  this._maxDataSizeExceeded = true;\n  var message =\n    'DelayedStream#maxDataSize of ' + this.maxDataSize + ' bytes exceeded.'\n  this.emit('error', new Error(message));\n};\n"],"names":["Stream","require$$0","delayed_stream","DelayedStream","this","source","dataSize","maxDataSize","pauseStream","_maxDataSizeExceeded","_released","_bufferedEvents","require$$1","inherits","create","options","delayedStream","option","realEmit","emit","_handleEmit","arguments","apply","on","pause","Object","defineProperty","prototype","configurable","enumerable","get","readable","setEncoding","resume","release","forEach","args","bind","pipe","r","length","_checkIfMaxDataSizeExceeded","push","message","Error"],"mappings":"0CAAA,IAAIA,EAASC,EAAkBD,OAG/BE,EAAiBC,EACjB,SAASA,IACPC,KAAKC,OAAS,KACdD,KAAKE,SAAW,EAChBF,KAAKG,YAAc,QACnBH,KAAKI,aAAc,EAEnBJ,KAAKK,sBAAuB,EAC5BL,KAAKM,WAAY,EACjBN,KAAKO,gBAAkB,GAXdC,EAaNC,SAASV,EAAeH,GAE7BG,EAAcW,OAAS,SAAST,EAAQU,GACtC,IAAIC,EAAgB,IAAIZ,KAGxB,IAAK,IAAIa,KADTF,EAAUA,GAAW,GAEnBC,EAAcC,GAAUF,EAAQE,GAGlCD,EAAcX,OAASA,EAEvB,IAAIa,EAAWb,EAAOc,KAWtB,OAVAd,EAAOc,KAAO,WAEZ,OADAH,EAAcI,YAAYC,WACnBH,EAASI,MAAMjB,EAAQgB,YAGhChB,EAAOkB,GAAG,SAAS,eACfP,EAAcR,aAChBH,EAAOmB,QAGFR,GAGTS,OAAOC,eAAevB,EAAcwB,UAAW,WAAY,CACzDC,cAAc,EACdC,YAAY,EACZC,IAAK,WACH,OAAO1B,KAAKC,OAAO0B,YAIvB5B,EAAcwB,UAAUK,YAAc,WACpC,OAAO5B,KAAKC,OAAO2B,YAAYV,MAAMlB,KAAKC,OAAQgB,YAGpDlB,EAAcwB,UAAUM,OAAS,WAC1B7B,KAAKM,WACRN,KAAK8B,UAGP9B,KAAKC,OAAO4B,UAGd9B,EAAcwB,UAAUH,MAAQ,WAC9BpB,KAAKC,OAAOmB,SAGdrB,EAAcwB,UAAUO,QAAU,WAChC9B,KAAKM,WAAY,EAEjBN,KAAKO,gBAAgBwB,QAAQ,SAASC,GACpChC,KAAKe,KAAKG,MAAMlB,KAAMgC,IACtBC,KAAKjC,OACPA,KAAKO,gBAAkB,IAGzBR,EAAcwB,UAAUW,KAAO,WAC7B,IAAIC,EAAIvC,EAAO2B,UAAUW,KAAKhB,MAAMlB,KAAMiB,WAE1C,OADAjB,KAAK6B,SACEM,GAGTpC,EAAcwB,UAAUP,YAAc,SAASgB,GACzChC,KAAKM,UACPN,KAAKe,KAAKG,MAAMlB,KAAMgC,IAIR,SAAZA,EAAK,KACPhC,KAAKE,UAAY8B,EAAK,GAAGI,OACzBpC,KAAKqC,+BAGPrC,KAAKO,gBAAgB+B,KAAKN,KAG5BjC,EAAcwB,UAAUc,4BAA8B,WACpD,KAAIrC,KAAKK,sBAILL,KAAKE,UAAYF,KAAKG,aAA1B,CAIAH,KAAKK,sBAAuB,EAC5B,IAAIkC,EACF,gCAAkCvC,KAAKG,YAAc,mBACvDH,KAAKe,KAAK,QAAS,IAAIyB,MAAMD"}