import e from"../platform/index.js";import t from"../utils.js";import r from"../core/AxiosError.js";import o from"../helpers/composeSignals.js";import{trackStream as s}from"../helpers/trackStream.js";import n from"../core/AxiosHeaders.js";import{progressEventDecorator as a,progressEventReducer as i,asyncDecorator as c}from"../helpers/progressEventReducer.js";import l from"../helpers/resolveConfig.js";import f from"../core/settle.js";const{isFunction:u}=t,d=(({Request:e,Response:t})=>({Request:e,Response:t}))(t.global),{ReadableStream:m,TextEncoder:p}=t.global,h=(e,...t)=>{try{return!!e(...t)}catch(e){return!1}},y=y=>{y=t.merge.call({skipUndefined:!0},d,y);const{fetch:g,Request:w,Response:b}=y,R=g?u(g):"function"==typeof fetch,x=u(w),T=u(b);if(!R)return!1;const S=R&&u(m),j=R&&("function"==typeof p?(E=new p,e=>E.encode(e)):async e=>new Uint8Array(await new w(e).arrayBuffer()));var E;const O=x&&S&&h((()=>{let t=!1;const r=new w(e.origin,{body:new m,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r})),P=T&&S&&h((()=>t.isReadableStream(new b("").body))),C={stream:P&&(e=>e.body)};R&&["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!C[e]&&(C[e]=(t,o)=>{let s=t&&t[e];if(s)return s.call(t);throw new r(`Response type '${e}' is not supported`,r.ERR_NOT_SUPPORT,o)})}));const v=async(r,o)=>{const s=t.toFiniteNumber(r.getContentLength());return null==s?(async r=>{if(null==r)return 0;if(t.isBlob(r))return r.size;if(t.isSpecCompliantForm(r)){const t=new w(e.origin,{method:"POST",body:r});return(await t.arrayBuffer()).byteLength}return t.isArrayBufferView(r)||t.isArrayBuffer(r)?r.byteLength:(t.isURLSearchParams(r)&&(r+=""),t.isString(r)?(await j(r)).byteLength:void 0)})(o):s};return async e=>{let{url:u,method:d,data:m,signal:p,cancelToken:h,timeout:y,onDownloadProgress:R,onUploadProgress:T,responseType:S,headers:j,withCredentials:E="same-origin",fetchOptions:L}=l(e),A=g||fetch;S=S?(S+"").toLowerCase():"text";let B=o([p,h&&h.toAbortSignal()],y),N=null;const U=B&&B.unsubscribe&&(()=>{B.unsubscribe()});let q;try{if(T&&O&&"get"!==d&&"head"!==d&&0!==(q=await v(j,m))){let e,r=new w(u,{method:"POST",body:m,duplex:"half"});if(t.isFormData(m)&&(e=r.headers.get("content-type"))&&j.setContentType(e),r.body){const[e,t]=a(q,i(c(T)));m=s(r.body,65536,e,t)}}t.isString(E)||(E=E?"include":"omit");const r=x&&"credentials"in w.prototype,o={...L,signal:B,method:d.toUpperCase(),headers:j.normalize().toJSON(),body:m,duplex:"half",credentials:r?E:void 0};N=x&&new w(u,o);let l=await(x?A(N,L):A(u,o));const p=P&&("stream"===S||"response"===S);if(P&&(R||p&&U)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=l[t]}));const r=t.toFiniteNumber(l.headers.get("content-length")),[o,n]=R&&a(r,i(c(R),!0))||[];l=new b(s(l.body,65536,o,(()=>{n&&n(),U&&U()})),e)}S=S||"text";let h=await C[t.findKey(C,S)||"text"](l,e);return!p&&U&&U(),await new Promise(((t,r)=>{f(t,r,{data:h,headers:n.from(l.headers),status:l.status,statusText:l.statusText,config:e,request:N})}))}catch(t){if(U&&U(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new r("Network Error",r.ERR_NETWORK,e,N),{cause:t.cause||t});throw r.from(t,t&&t.code,e,N)}}},g=new Map,w=e=>{let t=e?e.env:{};const{fetch:r,Request:o,Response:s}=t,n=[o,s,r];let a,i,c=n.length,l=g;for(;c--;)a=n[c],i=l.get(a),void 0===i&&l.set(a,i=c?new Map:y(t)),l=i;return i};w();export{w as getFetch};
//# sourceMappingURL=fetch.js.map
