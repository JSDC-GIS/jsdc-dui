import{__spreadArray as e,__awaiter as t,__generator as r,__assign as n}from"../../node_modules/tslib/tslib.es6.js";import i from"../LeftMenuBar/Credit/CreditMenuItem.js";import a from"../LeftMenuBar/Layer/LayerMenuItem.js";import o from"../LeftMenuBar/Legend/LegendMenuItem.js";import c from"../LeftMenuBar/MenuList/index.js";import m from"../LeftMenuBar/Weather/WeatherMenuItem.js";import u from"../MapViewContainer/index.js";import d,{useContext as l,useState as s,useMemo as f,useEffect as g}from"react";import{DuiContext as p}from"../Context/index.js";import{JSDCContext as h}from"../../JSDC/Context/index.js";import{latLng as v}from"leaflet";import M from"../LeftMenuBar/Scene/SceneMenuItem.js";import C from"../LeftMenuBar/AboutWalk/AboutWalkMenuItem.js";import{DguidewalksContext as I}from"../../JSDC/Dguidewalks/Context/index.js";import S from"../VisitorCount/index.js";import{mapKeys as b,pick as w,omit as L}from"lodash";var y=function(y){var j=y.mainMenuChildren,B=y.endMenuChildren,E=l(I).dgw,x=E.layerNameOrder,k=E.apiProvider,A=l(p),W=l(h),T=W.Jsdc,D=W.layerInfos,N=s(0),O=N[0],J=N[1],V=f((function(){var t=b(D,(function(e){return e.description.name})),r=Object.values(w(t,x)),n=Object.values(L(t,x));return e(e([],r,!0),n,!0)}),[D,x]);return g((function(){t(void 0,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,k.getVisitorCount()];case 1:return e=t.sent().counter,J(e),[3,3];case 2:return t.sent(),J(0),[3,3];case 3:return[2]}}))}))}),[]),d.createElement(u,{Jsdc:T,headerImgSrc:A.headerMBImgSrc,mapChildren:d.createElement(S,{value:O}),menuChildren:d.createElement(c,{title:A.sidebarTitle,subtitle:A.sidebarSubtitle,headerImg:A.headerDImgSrc,headerMBImg:A.headerMBImgSrc,endChildren:d.createElement(d.Fragment,null,d.createElement(C,n({imgSrc:A.aboutWalkImgSrc,title:A.sidebarTitle,subtitle:A.sidebarSubtitle,content:A.aboutWalkContent,active:"路線介紹"===A.activeMenuId},A.menuSwitcherAction("路線介紹"))),d.createElement(i,n({active:"關於圖臺"===A.activeMenuId},A.menuSwitcherAction("關於圖臺"),{herf:A.creditHref,description:A.credit})),B)},d.createElement(d.Fragment,null,d.createElement(a,n({layerInfos:V.map((function(e){return{id:e.id,type:e.description.type,name:e.description.name,show:e.show}})),onToggleShow:function(e,t){return T.Controller.get("Layer").getById(e).show=t},onOpacityChange:function(e,t){return T.Controller.get("Layer").getById(e).setOpacity(Number(1-t/100))},active:"地圖圖層"===A.activeMenuId},A.menuSwitcherAction("地圖圖層"))),d.createElement(M,n({onTarget:A.onSceneTargetClick,onNavigate:A.onSceneNavigate,cardsReducer:A.sceneCardsReducer,active:"景點介紹"===A.activeMenuId},A.menuSwitcherAction("景點介紹"))),A.weatherConfig.disabled||d.createElement(m,n({active:"氣象預測"===A.activeMenuId},A.menuSwitcherAction("氣象預測"),{locations:A.weatherConfig.locations,token:A.weatherConfig.token,onSelectLocation:function(e){var t,r=e[0],n=e[1];return null===(t=T.viewer)||void 0===t?void 0:t.flyTo(v(r,n),13)}})),d.createElement(o,n({active:"圖例說明"===A.activeMenuId},A.menuSwitcherAction("圖例說明"),{activeLegends:A.legendConfig.activeLegends})),j))})};y.displayName="DguideWalksApp";export{y as default};
//# sourceMappingURL=index.js.map
