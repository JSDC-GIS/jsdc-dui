import{__extends as t,__awaiter as e,__generator as r,__assign as n}from"../../../node_modules/tslib/tslib.es6.js";import i from"./AbsctractArticleProxyParser.js";var o=function(i){function o(t){return i.call(this,t)||this}return t(o,i),o.prototype.getAll=function(t){return e(this,void 0,void 0,(function(){var t,e,n;return r(this,(function(r){switch(r.label){case 0:return this.cache.hasArticles()?[2,this.cache.articles]:[4,this.proxyFetcher(this.url)];case 1:return t=r.sent(),e=this.parseHTML(t),n=this.getArticlesFromHTML(e),this.cache.summaryMap=n.reduce((function(t,e){return t[e.title]=e,t}),{}),[2,n]}}))}))},o.prototype.getDetailByTitle=function(t,i){return e(this,void 0,void 0,(function(){var e,i,o,l,c,a,s;return r(this,(function(r){switch(r.label){case 0:return e=this.cache.summaryMap[t],i=this.cache.externalMap[t],o=!!e,l=this.cache.hasExternalKey(t),o?l?[2,n(n({},e),i)]:[4,this.proxyFetcher(e.link)]:[3,2];case 1:return c=r.sent(),a=this.parseHTML(c),s=this.getExternalDetailFromHTML(a),this.cache.externalMap[t]=s,[2,n(n({},e),s)];case 2:throw new Error("failed to get by title: ".concat(t,", get all article first"))}}))}))},o.prototype.getArticlesFromHTML=function(t){return Array.from(t.querySelectorAll(".sppb-addon-article")).map((function(t){var e,r,n;return{title:(null===(e=t.querySelector("h3"))||void 0===e?void 0:e.innerText)||"null",content:(null===(r=t.querySelector(".sppb-article-introtext"))||void 0===r?void 0:r.innerHTML)||"null",imgSrc:t.querySelector("a img").src||"null",link:(null===(n=t.querySelector("a"))||void 0===n?void 0:n.href)||"null"}}))},o.prototype.getExternalDetailFromHTML=function(t){var e,r,n,i=null===(e=t.querySelector(".sppb-addon-content p.d-h3"))||void 0===e?void 0:e.innerText;return{subtitle:null===(r=t.querySelector(".entry-header .tags"))||void 0===r?void 0:r.innerText,ref:null===(n=t.querySelector(".sppb-addon-content p:nth-child(4) span"))||void 0===n?void 0:n.innerText,content:i}},o}(i);export{o as default};
//# sourceMappingURL=index.js.map
