# jsdc-dui i18n 多國語系完整指南

## 📖 目錄
- [概述](#概述)
- [給開發者：專案實作說明](#給開發者專案實作說明)
- [給使用者：套件使用指南](#給使用者套件使用指南)

---

## 概述

`jsdc-dui` 套件已成功整合 `react-i18next` 實現多國語系功能，支援**繁體中文 (zh-TW)** 和**英文 (en)**。

---

# 給開發者：專案實作說明

本節說明 i18n 在 jsdc-dui 專案中的實作細節。

## 已完成的修改

### 1. 安裝套件
- `i18next`: 核心 i18n 框架
- `react-i18next`: React 整合套件

這兩個套件已加入 `package.json` 的 `dependencies` 中，使用者安裝 jsdc-dui 時會自動安裝。

### 2. 檔案結構

```
src/
├── i18n/
│   ├── config.ts                    # i18n 初始化設定
│   ├── index.ts                     # Export 所有 i18n 功能
│   ├── useTranslatedMenuItems.ts    # 選單項目翻譯 Hook
│   └── locales/
│       ├── zh-TW.json              # 繁體中文翻譯
│       └── en.json                 # 英文翻譯
├── components/
│   └── LanguageSwitcher/           # 語言切換器元件
│       ├── index.tsx
│       └── index.scss
```

### 3. 已翻譯的元素

#### 選單項目
- **地圖圖層** → Map Layers
- **景點介紹** → Attractions
- **氣象預測** → Weather Forecast
- **圖例說明** → Legend
- **路線介紹** → Route Introduction
- **關於圖臺** → About Platform

#### 版權文字
- **版權所有 Ⓒ {{year}}** → Copyright Ⓒ {{year}}
- **平台內容維護｜智紳數位文化事業有限公司** → Platform Maintenance | JRSHEN Digital Culture Co., Ltd.
- **Design by someDesign** → Design by someDesign

### 4. 修改的元件檔案

- [src/components/LeftMenuBar/Layer/LayerMenuItem.tsx](src/components/LeftMenuBar/Layer/LayerMenuItem.tsx)
- [src/components/LeftMenuBar/Scene/SceneMenuItem.tsx](src/components/LeftMenuBar/Scene/SceneMenuItem.tsx)
- [src/components/LeftMenuBar/Weather/WeatherMenuItem.tsx](src/components/LeftMenuBar/Weather/WeatherMenuItem.tsx)
- [src/components/LeftMenuBar/Legend/LegendMenuItem.tsx](src/components/LeftMenuBar/Legend/LegendMenuItem.tsx)
- [src/components/LeftMenuBar/AboutWalk/AboutWalkMenuItem.tsx](src/components/LeftMenuBar/AboutWalk/AboutWalkMenuItem.tsx)
- [src/components/LeftMenuBar/Credit/CreditMenuItem.tsx](src/components/LeftMenuBar/Credit/CreditMenuItem.tsx)
- [src/components/MapViewContainer/index.tsx](src/components/MapViewContainer/index.tsx)
- [src/index.tsx](src/index.tsx) (初始化 i18n)

### 5. Build 設定

在 [rollup.config.js](rollup.config.js) 中已加入 i18n 目錄和 JSON 翻譯檔案：

```javascript
input: [
  ...getFiles('./src/components', extensions),
  ...getFiles('./src/i18n', extensions),  // ← 加入 i18n
  './src/i18n/locales/zh-TW.json',        // ← JSON 翻譯檔
  './src/i18n/locales/en.json',
],
```

Build 後 i18n 檔案會出現在 `dist/i18n/` 目錄。

### 6. 開發時使用

在專案開發時使用翻譯：

```typescript
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { t } = useTranslation()
  return <div>{t('menu.mapLayer')}</div>
}
```

新增翻譯內容：

1. 在 `src/i18n/locales/zh-TW.json` 和 `en.json` 中新增鍵值
2. 在元件中使用 `t('your.key')`

### 7. 注意事項

1. **TypeScript 警告**: 由於專案使用 TypeScript 4.6.3，而 i18next 使用較新的型別特性，build 時會出現一些型別警告。這些警告不會影響功能運作。

2. **Build 成功**: 專案已成功 build，所有功能正常運作。

3. **擴充性**: 若要新增其他語言：
   - 在 `src/i18n/locales/` 新增 JSON 檔案（如 `ja.json`）
   - 在 `src/i18n/config.ts` 的 resources 中註冊新語言
   - 在 `rollup.config.js` 的 input 中加入新的 JSON 檔案
   - 在 `LanguageSwitcher` 元件中新增對應的按鈕

---

# 給使用者：套件使用指南

本節說明如何在你的專案中使用 jsdc-dui 的多國語系功能。

## 安裝

```bash
npm install jsdc-dui
# 或
yarn add jsdc-dui
```

安裝 jsdc-dui 時會自動安裝 `i18next` 和 `react-i18next` 依賴。

## ⚠️ 重要：初始化 i18n

**在你的專案中使用 jsdc-dui 元件前，必須先初始化 i18n。**

如果沒有初始化，元件會顯示翻譯鍵值（如 `menu.mapLayer`）而不是實際文字。

### 方法 1：使用套件內建的 i18n 設定（推薦）

在你的專案入口檔案（如 `src/index.tsx` 或 `src/App.tsx`）**最上方**加入：

```typescript
// ⚠️ 必須在最開始匯入，在任何其他 import 之前
import 'jsdc-dui/dist/i18n/config'

// 然後才匯入其他東西
import React from 'react'
import ReactDOM from 'react-dom'
import App from './App'

ReactDOM.render(<App />, document.getElementById('root'))
```

### 方法 2：自訂 i18n 設定

如果你想要自訂翻譯內容或新增更多語言：

**步驟 1**: 建立 `src/i18n.ts` 或 `src/i18n/index.ts`：

```typescript
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'

// 導入 jsdc-dui 的翻譯
import jsdcZhTW from 'jsdc-dui/dist/i18n/locales/zh-TW.json'
import jsdcEn from 'jsdc-dui/dist/i18n/locales/en.json'

// 你的自訂翻譯
const customZhTW = {
  ...jsdcZhTW,
  // 加入你自己的翻譯
  myApp: {
    title: '我的應用程式',
    welcome: '歡迎使用'
  }
}

const customEn = {
  ...jsdcEn,
  myApp: {
    title: 'My Application',
    welcome: 'Welcome'
  }
}

i18n
  .use(initReactI18next)
  .init({
    resources: {
      'zh-TW': {
        translation: customZhTW,
      },
      'en': {
        translation: customEn,
      },
      // 可以新增更多語言
      'ja': {
        translation: {
          ...jsdcZhTW, // 先用中文當 fallback
          menu: {
            mapLayer: 'マップレイヤー',
            sceneIntro: 'アトラクション',
            weatherForecast: '天気予報',
            legendDescription: '凡例',
            routeIntro: 'ルート紹介',
            aboutPlatform: 'プラットフォームについて',
          },
          myApp: {
            title: 'マイアプリケーション',
            welcome: 'ようこそ'
          }
        }
      }
    },
    lng: 'zh-TW', // 預設語言
    fallbackLng: 'zh-TW',
    interpolation: {
      escapeValue: false,
    },
  })

export default i18n
```

**步驟 2**: 在入口檔案匯入：

```typescript
// ⚠️ 必須在最開始匯入
import './i18n'

import React from 'react'
import ReactDOM from 'react-dom'
import App from './App'
// ... 其他程式碼
```

## 使用語言切換器

jsdc-dui 提供了內建的語言切換器元件：

```typescript
import { LanguageSwitcher } from 'jsdc-dui/dist/components/LanguageSwitcher'

function App() {
  return (
    <div>
      <header>
        <h1>我的應用程式</h1>
        <LanguageSwitcher />
      </header>
      {/* 其他元件 */}
    </div>
  )
}
```

## 已翻譯的元件

以下 jsdc-dui 元件會根據 i18n 設定自動顯示對應語言：

| 元件 | 繁體中文 | English |
|------|---------|---------|
| `LayerMenuItem` | 地圖圖層 | Map Layers |
| `SceneMenuItem` | 景點介紹 | Attractions |
| `WeatherMenuItem` | 氣象預測 | Weather Forecast |
| `LegendMenuItem` | 圖例說明 | Legend |
| `AboutWalkMenuItem` | 路線介紹 | Route Introduction |
| `CreditMenuItem` | 關於圖臺 | About Platform |
| `MapViewContainer` | 版權文字 | Copyright text |

## 翻譯鍵值對照表

| 鍵值 | 繁體中文 | English |
|------|---------|---------|
| `menu.mapLayer` | 地圖圖層 | Map Layers |
| `menu.sceneIntro` | 景點介紹 | Attractions |
| `menu.weatherForecast` | 氣象預測 | Weather Forecast |
| `menu.legendDescription` | 圖例說明 | Legend |
| `menu.routeIntro` | 路線介紹 | Route Introduction |
| `menu.aboutPlatform` | 關於圖臺 | About Platform |
| `copyright.text` | 版權所有 Ⓒ {{year}} | Copyright Ⓒ {{year}} |
| `copyright.maintenance` | 平台內容維護｜智紳數位文化事業有限公司/ | Platform Maintenance \| JRSHEN Digital Culture Co., Ltd. / |
| `copyright.design` | Design by someDesign | Design by someDesign |

## 在你的元件中使用翻譯

你可以在自己的元件中使用 jsdc-dui 的翻譯：

```typescript
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { t, i18n } = useTranslation()

  return (
    <div>
      <h1>{t('menu.mapLayer')}</h1>
      <p>當前語言: {i18n.language}</p>

      <button onClick={() => i18n.changeLanguage('en')}>
        Switch to English
      </button>
      <button onClick={() => i18n.changeLanguage('zh-TW')}>
        切換到中文
      </button>
    </div>
  )
}
```

### 使用參數化翻譯

```typescript
// 在翻譯檔案中
{
  "greeting": "你好, {{name}}!",
  "itemCount": "你有 {{count}} 個項目"
}

// 在元件中
const { t } = useTranslation()

t('greeting', { name: '張三' })           // "你好, 張三!"
t('itemCount', { count: 5 })             // "你有 5 個項目"
t('copyright.text', { year: 2025 })      // "版權所有 Ⓒ 2025"
```

## 常見問題

### Q: 為什麼元件顯示 `menu.mapLayer` 而不是文字？

**A**: 這表示 i18n 沒有被正確初始化。請確認：

1. ✅ 在入口檔案**最上方**有 `import 'jsdc-dui/dist/i18n/config'`
2. ✅ 這行 import 必須在**任何其他 import 之前**
3. ✅ 檢查瀏覽器 console 是否有錯誤訊息

**錯誤範例** ❌：
```typescript
import React from 'react'
import 'jsdc-dui/dist/i18n/config'  // ❌ 太晚了
```

**正確範例** ✅：
```typescript
import 'jsdc-dui/dist/i18n/config'  // ✅ 第一行
import React from 'react'
```

### Q: 可以只使用中文或英文嗎？

**A**: 可以。在初始化 i18n 時，只需設定你想要的語言：

```typescript
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import zhTW from 'jsdc-dui/dist/i18n/locales/zh-TW.json'

i18n
  .use(initReactI18next)
  .init({
    resources: {
      'zh-TW': {
        translation: zhTW,
      }
    },
    lng: 'zh-TW',
    fallbackLng: 'zh-TW',
    interpolation: {
      escapeValue: false,
    },
  })
```

### Q: 如何新增其他語言（如日文、韓文）？

**A**: 參考「方法 2：自訂 i18n 設定」，在 resources 中新增對應的語言並提供所有翻譯鍵值。

### Q: 可以覆蓋預設翻譯嗎？

**A**: 可以。使用方法 2 自訂 i18n 設定，並覆蓋對應的鍵值：

```typescript
const customZhTW = {
  ...jsdcZhTW,
  menu: {
    ...jsdcZhTW.menu,
    mapLayer: '地圖圖層管理',  // 覆蓋預設翻譯
  }
}
```

### Q: 語言偏好會被儲存嗎？

**A**: 預設情況下，i18next 會將語言偏好儲存在瀏覽器的 localStorage 中。使用者切換語言後，下次開啟網頁會自動使用上次選擇的語言。

如果想要停用此功能，可以在初始化時設定：

```typescript
i18n.init({
  // ...
  detection: {
    caches: []  // 不儲存到 localStorage
  }
})
```

## 範例專案

完整的使用範例可參考：
- jsdc-dui 原始碼中的 [src/index.tsx](src/index.tsx)
- 各個 MenuItem 元件的實作

## 技術支援

如有問題，請至 GitHub Issues 回報：
[https://github.com/60723005l/jsdc-dui/issues](https://github.com/60723005l/jsdc-dui/issues)

---

## 測試

執行以下命令測試：

```bash
# 開發模式
npm start

# 建置
npm run build
```

## 未來改進建議

1. 將更多硬編碼文字移至翻譯檔案
2. 為景點介紹、路線說明等動態內容實作多語系支援
3. 考慮升級 TypeScript 版本以消除型別警告（需評估專案相容性）
4. 提供更多內建語言支援（日文、韓文等）
